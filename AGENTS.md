# AGENTS.md - HiveForge Development Guidelines

このファイルはAIエージェント（GitHub Copilot、Claude等）がHiveForgeプロジェクトで作業する際のガイドラインです。

## 核心的信念

> **信頼できる部品を、信頼できる組み合わせ方をして、信頼できるシステムを作る**

この信念がHiveForgeの開発哲学の根幹です。

## 開発原則

### 1. テスト駆動開発 (TDD)

- **テストを先に書く**: 実装前にテストを書き、失敗することを確認する
- **小さな単位でテスト**: 各関数・クラスが単一責任を持ち、独立してテスト可能であること
- **テストは仕様である**: テストコードがドキュメントとして機能する

### 2. 細かいコミット

- **1つの変更 = 1つのコミット**: 論理的に独立した変更ごとにコミット
- **コミットメッセージは明確に**: `feat:`, `fix:`, `test:`, `chore:`, `docs:`, `refactor:` のプレフィックスを使用
- **壊れた状態をコミットしない**: 各コミットでテストが通る状態を維持

### 3. イミュータブル設計

- **イベントは不変**: 一度作成されたイベントは変更されない
- **状態は投影で再構築**: イベントから常に状態を再現可能
- **副作用の分離**: 純粋関数とI/Oを明確に分離

### 4. 信頼できる部品

- **Pydantic**: 型安全なデータモデル
- **ULID**: 時間順序付きユニークID
- **JCS (RFC 8785)**: 決定論的JSONシリアライズ
- **SHA-256**: 暗号学的ハッシュによるイベントチェーン

## コードスタイル

- Python 3.12+
- 型ヒント必須
- Ruffでフォーマット・リント
- docstringは日本語可

## ディレクトリ構造

```
src/hiveforge/
├── core/           # コアロジック（イベント、状態機械、AR）
│   ├── events.py   # イベントモデル
│   ├── ar/         # Akashic Record（永続化）
│   └── state/      # 状態機械
├── api/            # FastAPI サーバー
├── mcp_server/     # MCP Server
└── cli.py          # CLIツール

tests/              # テストコード（実装と1:1対応）
```

## テスト実行

```bash
# 全テスト
pytest

# 特定のテスト
pytest tests/test_events.py -v

# カバレッジ付き
pytest --cov=hiveforge --cov-report=html
```

## 作業フロー

1. テストを書く（RED）
2. テストが失敗することを確認
3. 最小限の実装を書く（GREEN）
4. コミット
5. リファクタリング（REFACTOR）
6. コミット
7. 次のテストへ
