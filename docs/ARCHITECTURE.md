# HiveForge ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆæ›¸

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€HiveForgeã®ç¾åœ¨ã®è¨­è¨ˆã¨å®Ÿè£…çŠ¶æ³ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ](#2-ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#3-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
4. [APIä»•æ§˜](#4-apiä»•æ§˜)
5. [çŠ¶æ…‹æ©Ÿæ¢°](#5-çŠ¶æ…‹æ©Ÿæ¢°)
6. [ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ](#6-ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ )
7. [å› æœãƒªãƒ³ã‚¯ï¼ˆLineageï¼‰](#7-å› æœãƒªãƒ³ã‚¯lineage)
8. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#8-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
9. [è¨­å®š](#9-è¨­å®š)
10. [ä»Šå¾Œã®æ‹¡å¼µ](#10-ä»Šå¾Œã®æ‹¡å¼µ)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 åŸºæœ¬æ€æƒ³

HiveForgeã¯ã€Œ**ä¿¡é ¼ã§ãã‚‹éƒ¨å“ã‚’ã€ä¿¡é ¼ã§ãã‚‹çµ„ã¿åˆã‚ã›æ–¹ã‚’ã—ã¦ã€ä¿¡é ¼ã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚‹**ã€ã¨ã„ã†ç†å¿µã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚

### 1.2 ã‚³ã‚¢åŸå‰‡

- **ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚·ãƒ³ã‚°**: å…¨ã¦ã®çŠ¶æ…‹å¤‰æ›´ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²
- **ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«**: ã‚¤ãƒ™ãƒ³ãƒˆã¯ä¸€åº¦æ›¸ãè¾¼ã¾ã‚ŒãŸã‚‰å¤‰æ›´ä¸å¯
- **è¿½è·¡å¯èƒ½æ€§**: ä»»æ„ã®æˆæœç‰©ã‹ã‚‰ã€Œãªãœã€ã‚’é¡åŠå¯èƒ½
- **åˆ¶å¾¡å¯èƒ½æ€§**: çŠ¶æ…‹æ©Ÿæ¢°ã«ã‚ˆã‚‹å³å¯†ãªçŠ¶æ…‹ç®¡ç†ã¨ç·Šæ€¥åœæ­¢

### 1.3 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VS Code                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  GitHub Copilot  â”‚  â”‚  HiveForge Extension           â”‚   â”‚
â”‚  â”‚      Chat        â”‚  â”‚  â”œâ”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (Webview)    â”‚   â”‚
â”‚  â”‚  ï¼ˆå¯¾è©±ãƒ»æ“ä½œï¼‰   â”‚  â”‚  â”œâ”€ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚° (TreeView)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼             â”‚   â”‚
â”‚           â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ MCP                         â”‚ HTTP
            â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HiveForge MCP Server â”‚    â”‚    HiveForge API Server     â”‚
â”‚  (stdioé€šä¿¡)          â”‚    â”‚    (FastAPI / REST)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         Hive Core            â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚  â”‚   Akashic Record (AR)  â”‚  â”‚
            â”‚  â”‚   - ã‚¤ãƒ™ãƒ³ãƒˆæ°¸ç¶šåŒ–     â”‚  â”‚
            â”‚  â”‚   - ãƒãƒƒã‚·ãƒ¥é€£é–       â”‚  â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚  â”‚    State Machines      â”‚  â”‚
            â”‚  â”‚   - Run / Task / Req   â”‚  â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            â”‚  â”‚     Projections        â”‚  â”‚
            â”‚  â”‚   - ã‚¤ãƒ™ãƒ³ãƒˆâ†’çŠ¶æ…‹     â”‚  â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      Vault (ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ )  â”‚
            â”‚  â””â”€â”€ {run_id}/events.jsonl   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### 2.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | å½¹å‰² | å®Ÿè£…çŠ¶æ³ |
|----------------|------|----------|
| **Hive Core** | ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ãƒ»çŠ¶æ…‹æ©Ÿæ¢°ãƒ»æŠ•å½± | âœ… å®Œäº† |
| **API Server** | REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | âœ… å®Œäº† |
| **MCP Server** | Copilot Chaté€£æº | âœ… å®Œäº† |
| **CLI** | ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | âœ… å®Œäº† |
| **VS Codeæ‹¡å¼µ** | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»å¯è¦–åŒ– | ğŸ”„ åŸºæœ¬å®Ÿè£…æ¸ˆ |
| **Silence Detector** | æ²ˆé»™æ¤œå‡º | âœ… å®Œäº† |

### 2.2 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚

```
hiveforge/
â”œâ”€â”€ core/                  # ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆä»–ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ï¼‰
â”‚   â”œâ”€â”€ events.py         # ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ config.py         # è¨­å®šç®¡ç†
â”‚   â”œâ”€â”€ ar/               # Akashic Record
â”‚   â”‚   â”œâ”€â”€ storage.py    # æ°¸ç¶šåŒ–
â”‚   â”‚   â””â”€â”€ projections.py # çŠ¶æ…‹æŠ•å½±
â”‚   â””â”€â”€ state/            # çŠ¶æ…‹æ©Ÿæ¢°
â”‚       â””â”€â”€ machines.py   # Run/Task/Requirement SM
â”œâ”€â”€ api/                   # REST APIï¼ˆcoreã«ä¾å­˜ï¼‰
â”‚   â””â”€â”€ server.py
â”œâ”€â”€ mcp_server/            # MCP Serverï¼ˆcoreã«ä¾å­˜ï¼‰
â”‚   â””â”€â”€ server.py
â”œâ”€â”€ silence.py             # æ²ˆé»™æ¤œå‡ºï¼ˆcoreã«ä¾å­˜ï¼‰
â””â”€â”€ cli.py                 # CLIï¼ˆapi, mcp_serverã«ä¾å­˜ï¼‰
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 3.1 BaseEventï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåŸºåº•ã‚¯ãƒ©ã‚¹ï¼‰

ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆã®åŸºåº•ã¨ãªã‚‹ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ¢ãƒ‡ãƒ«:

```python
class BaseEvent(BaseModel):
    model_config = {"frozen": True}  # ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«
    
    id: str                    # ULIDå½¢å¼ã®ã‚¤ãƒ™ãƒ³ãƒˆID
    type: EventType            # ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥
    timestamp: datetime        # ç™ºç”Ÿæ™‚åˆ»ï¼ˆUTCï¼‰
    run_id: str | None         # é–¢é€£ã™ã‚‹Runã®ID
    task_id: str | None        # é–¢é€£ã™ã‚‹Taskã®ID
    actor: str                 # ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿè€…
    payload: dict[str, Any]    # ã‚¤ãƒ™ãƒ³ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
    prev_hash: str | None      # å‰ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ï¼ˆãƒã‚§ãƒ¼ãƒ³ç”¨ï¼‰
    parents: list[str]         # è¦ªã‚¤ãƒ™ãƒ³ãƒˆã®IDï¼ˆå› æœãƒªãƒ³ã‚¯ç”¨ï¼‰
    
    @computed_field
    def hash(self) -> str:     # JCSæ­£è¦åŒ– + SHA-256
        ...
```

### 3.2 ã‚¤ãƒ™ãƒ³ãƒˆå‹ä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | ã‚¤ãƒ™ãƒ³ãƒˆå‹ | èª¬æ˜ |
|----------|------------|------|
| **Run** | `run.started` | Runé–‹å§‹ |
| | `run.completed` | Runå®Œäº† |
| | `run.failed` | Runå¤±æ•— |
| | `run.aborted` | Runä¸­æ–­ |
| **Task** | `task.created` | Taskä½œæˆ |
| | `task.assigned` | Taskå‰²ã‚Šå½“ã¦ |
| | `task.progressed` | é€²æ—æ›´æ–° |
| | `task.completed` | Taskå®Œäº† |
| | `task.failed` | Taskå¤±æ•— |
| | `task.blocked` | Taskãƒ–ãƒ­ãƒƒã‚¯ |
| | `task.unblocked` | ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤ |
| **Requirement** | `requirement.created` | è¦ä»¶ä½œæˆ |
| | `requirement.approved` | æ‰¿èª |
| | `requirement.rejected` | å´ä¸‹ |
| **LLM** | `llm.request` | LLMãƒªã‚¯ã‚¨ã‚¹ãƒˆ |
| | `llm.response` | LLMãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
| **System** | `system.heartbeat` | ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ |
| | `system.error` | ã‚¨ãƒ©ãƒ¼ |
| | `system.silence_detected` | æ²ˆé»™æ¤œå‡º |
| | `system.emergency_stop` | ç·Šæ€¥åœæ­¢ |

### 3.3 RunProjectionï¼ˆçŠ¶æ…‹æŠ•å½±ï¼‰

ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å°å‡ºã•ã‚Œã‚‹ç¾åœ¨çŠ¶æ…‹:

```python
class RunProjection:
    id: str                           # Run ID
    goal: str                         # ç›®æ¨™
    state: RunState                   # çŠ¶æ…‹
    started_at: datetime | None       # é–‹å§‹æ™‚åˆ»
    completed_at: datetime | None     # å®Œäº†æ™‚åˆ»
    tasks: dict[str, TaskProjection]  # ã‚¿ã‚¹ã‚¯ä¸€è¦§
    requirements: dict[str, RequirementProjection]  # è¦ä»¶ä¸€è¦§
    event_count: int                  # ã‚¤ãƒ™ãƒ³ãƒˆæ•°
    last_heartbeat: datetime | None   # æœ€çµ‚ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ
```

### 3.4 TaskProjection

```python
class TaskProjection:
    id: str
    title: str
    state: TaskState        # pending/assigned/in_progress/completed/failed/blocked
    progress: int           # 0-100
    assignee: str | None
    retry_count: int
    created_at: datetime
```

---

## 4. APIä»•æ§˜

### 4.1 REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### System

| Method | Path | èª¬æ˜ |
|--------|------|------|
| GET | `/health` | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ |

#### Runs

| Method | Path | èª¬æ˜ |
|--------|------|------|
| POST | `/runs` | Runé–‹å§‹ |
| GET | `/runs` | Runä¸€è¦§å–å¾— |
| GET | `/runs/{run_id}` | Runè©³ç´°å–å¾— |
| POST | `/runs/{run_id}/complete` | Runå®Œäº† |
| POST | `/runs/{run_id}/emergency-stop` | ç·Šæ€¥åœæ­¢ |
| POST | `/runs/{run_id}/heartbeat` | ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆé€ä¿¡ |

#### Tasks

| Method | Path | èª¬æ˜ |
|--------|------|------|
| POST | `/runs/{run_id}/tasks` | Taskä½œæˆ |
| GET | `/runs/{run_id}/tasks` | Taskä¸€è¦§å–å¾— |
| POST | `/runs/{run_id}/tasks/{task_id}/complete` | Taskå®Œäº† |
| POST | `/runs/{run_id}/tasks/{task_id}/fail` | Taskå¤±æ•— |

#### Events

| Method | Path | èª¬æ˜ |
|--------|------|------|
| GET | `/runs/{run_id}/events` | ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§å–å¾— |
| GET | `/runs/{run_id}/events/{event_id}/lineage` | å› æœãƒªãƒ³ã‚¯å–å¾— |

### 4.2 MCP ãƒ„ãƒ¼ãƒ«ä¸€è¦§

| ãƒ„ãƒ¼ãƒ« | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|--------|------|------------|
| `start_run` | Runé–‹å§‹ | `goal` |
| `get_run_status` | çŠ¶æ…‹å–å¾— | `run_id?` |
| `create_task` | Taskä½œæˆ | `title`, `description?` |
| `assign_task` | Taskå‰²ã‚Šå½“ã¦ | `task_id` |
| `report_progress` | é€²æ—å ±å‘Š | `task_id`, `progress`, `message?` |
| `complete_task` | Taskå®Œäº† | `task_id`, `result?` |
| `fail_task` | Taskå¤±æ•— | `task_id`, `error`, `retryable?` |
| `create_requirement` | è¦ä»¶ä½œæˆ | `description`, `options?` |
| `complete_run` | Runå®Œäº† | `summary?` |
| `heartbeat` | ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ | `message?` |
| `emergency_stop` | ç·Šæ€¥åœæ­¢ | `reason`, `scope?` |
| `get_lineage` | å› æœãƒªãƒ³ã‚¯å–å¾— | `event_id`, `direction?`, `max_depth?` |

---

## 5. çŠ¶æ…‹æ©Ÿæ¢°

### 5.1 RunStateMachine

```
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚      RUNNING      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMPLETED â”‚   â”‚  FAILED   â”‚   â”‚  ABORTED  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| é·ç§»å…ƒ | é·ç§»å…ˆ | ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ |
|--------|--------|------------------|
| RUNNING | COMPLETED | `run.completed` |
| RUNNING | FAILED | `run.failed` |
| RUNNING | ABORTED | `run.aborted`, `system.emergency_stop` |

### 5.2 TaskStateMachine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          
â”‚ PENDING â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚
     â”‚ task.assigned                 â”‚
     â–¼                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ ASSIGNED â”‚                         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                         â”‚
     â”‚ task.progressed               â”‚
     â–¼                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    task.blocked      â”‚
â”‚ IN_PROGRESS â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â”‚     â”‚
       â”‚                       â”‚     â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
       â”‚                       â”‚     â”‚
       â–¼                       â–¼     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ COMPLETED â”‚           â”‚ BLOCKED â”‚â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                       â”‚
       â”‚                       â”‚
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
       â””â”€â”€â”€â”€â”‚  FAILED  â”‚â—„â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 RequirementStateMachine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚
     â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APPROVED â”‚      â”‚ REJECTED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 

### 6.1 ã‚¤ãƒ™ãƒ³ãƒˆæ°¸ç¶šåŒ–

ã‚¤ãƒ™ãƒ³ãƒˆã¯JSONLå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ä¿å­˜:

```
Vault/
â””â”€â”€ {run_id}/
    â””â”€â”€ events.jsonl    # 1è¡Œ1ã‚¤ãƒ™ãƒ³ãƒˆ
```

### 6.2 ãƒãƒƒã‚·ãƒ¥é€£é–

å„ã‚¤ãƒ™ãƒ³ãƒˆã¯å‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚’ä¿æŒã—ã€æ”¹ã–ã‚“æ¤œçŸ¥ã‚’å¯èƒ½ã«:

```
event[0] â”€hashâ”€â–¶ event[1] â”€hashâ”€â–¶ event[2] â”€hashâ”€â–¶ ...
           â”‚              â”‚              â”‚
        prev_hash      prev_hash      prev_hash
```

### 6.3 ãƒãƒƒã‚·ãƒ¥è¨ˆç®—

1. ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰`hash`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é™¤å¤–
2. JCS (RFC 8785) ã§æ­£è¦åŒ–
3. SHA-256ã§ãƒãƒƒã‚·ãƒ¥è¨ˆç®—

```python
def compute_hash(data: dict[str, Any]) -> str:
    data_for_hash = {k: v for k, v in data.items() if k != "hash"}
    data_for_hash = _serialize_value(data_for_hash)  # datetimeç­‰ã‚’å¤‰æ›
    canonical = jcs.canonicalize(data_for_hash)
    return hashlib.sha256(canonical).hexdigest()
```

---

## 7. å› æœãƒªãƒ³ã‚¯ï¼ˆLineageï¼‰

### 7.1 æ¦‚è¦

å„ã‚¤ãƒ™ãƒ³ãƒˆã¯`parents`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§è¦ªã‚¤ãƒ™ãƒ³ãƒˆã‚’å‚ç…§ã—ã€å› æœé–¢ä¿‚ã‚’è¨˜éŒ²:

```python
class TaskCreatedEvent(BaseEvent):
    parents: list[str] = ["run_started_event_id"]  # è¦ªã‚¤ãƒ™ãƒ³ãƒˆã®ID
```

### 7.2 æ¢ç´¢æ–¹å‘

| æ–¹å‘ | èª¬æ˜ | å®Ÿè£…æ–¹å¼ |
|------|------|----------|
| `ancestors` | ç¥–å…ˆï¼ˆè¦ªæ–¹å‘ï¼‰ | `parents[]`ã‚’å†å¸°çš„ã«è¾¿ã‚‹ |
| `descendants` | å­å­«ï¼ˆå­æ–¹å‘ï¼‰ | å…¨ã‚¤ãƒ™ãƒ³ãƒˆèµ°æŸ» |
| `both` | ä¸¡æ–¹å‘ | ä¸Šè¨˜ã®çµ„ã¿åˆã‚ã› |

### 7.3 APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

```json
{
  "event_id": "01HZZ...",
  "ancestors": ["01HZY...", "01HZX..."],
  "descendants": ["01J00...", "01J01..."],
  "truncated": false
}
```

### 7.4 åˆ¶é™

- `max_depth`: æ¢ç´¢æ·±åº¦åˆ¶é™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
- `truncated`: åˆ¶é™ã«ã‚ˆã‚Šåˆ‡ã‚Šè©°ã‚ã‚‰ã‚ŒãŸå ´åˆ`true`

---

## 8. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### 8.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
HiveForge/
â”œâ”€â”€ src/hiveforge/           # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py               # CLIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ silence.py           # æ²ˆé»™æ¤œå‡º
â”‚   â”œâ”€â”€ core/                # ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py        # è¨­å®šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ events.py        # ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ ar/              # Akashic Record
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.py   # æ°¸ç¶šåŒ–
â”‚   â”‚   â”‚   â””â”€â”€ projections.py # çŠ¶æ…‹æŠ•å½±
â”‚   â”‚   â””â”€â”€ state/           # çŠ¶æ…‹æ©Ÿæ¢°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ machines.py
â”‚   â”œâ”€â”€ api/                 # REST API
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ server.py
â”‚   â””â”€â”€ mcp_server/          # MCP Server
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ server.py
â”œâ”€â”€ tests/                   # ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_events.py
â”‚   â”œâ”€â”€ test_ar.py
â”‚   â”œâ”€â”€ test_projections.py
â”‚   â”œâ”€â”€ test_state_machines.py
â”‚   â”œâ”€â”€ test_silence.py
â”‚   â”œâ”€â”€ test_cli.py
â”‚   â”œâ”€â”€ test_api.py
â”‚   â””â”€â”€ test_mcp_server.py
â”œâ”€â”€ vscode-extension/        # VS Codeæ‹¡å¼µ
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ extension.ts
â”œâ”€â”€ docs/                    # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ QUICKSTART.md
â”‚   â””â”€â”€ ARCHITECTURE.md
â”œâ”€â”€ Vault/                   # ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ï¼ˆgitignoreï¼‰
â”œâ”€â”€ AGENTS.md                # AIé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
â”œâ”€â”€ ã‚³ãƒ³ã‚»ãƒ—ãƒˆ_v3.md          # å®Œå…¨ãªè¨­è¨ˆä»•æ§˜
â”œâ”€â”€ pyproject.toml           # Pythonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ hiveforge.config.yaml    # å®Ÿè¡Œæ™‚è¨­å®š
â”œâ”€â”€ docker-compose.yml       # Dockerè¨­å®š
â””â”€â”€ Dockerfile
```

### 8.2 Vaultæ§‹é€ 

```
Vault/
â”œâ”€â”€ {run_id}/
â”‚   â””â”€â”€ events.jsonl         # ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ï¼ˆ1è¡Œ1ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
â””â”€â”€ ...
```

---

## 9. è¨­å®š

### 9.1 hiveforge.config.yaml

```yaml
hive:
  name: "poc-project"
  vault_path: "./Vault"

governance:
  max_retries: 3              # ã‚¿ã‚¹ã‚¯ã®æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°
  max_oscillations: 5         # çŠ¶æ…‹æŒ¯å‹•æ¤œå‡ºé–¾å€¤
  max_concurrent_tasks: 10    # åŒæ™‚å®Ÿè¡Œã‚¿ã‚¹ã‚¯æ•°ä¸Šé™
  task_timeout_seconds: 300   # ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
  heartbeat_interval_seconds: 30  # ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆé–“éš”
  approval_timeout_hours: 24  # æ‰¿èªå¾…ã¡ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  archive_after_days: 7       # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ—¥æ•°

llm:
  provider: "openai"
  model: "gpt-4o"
  api_key_env: "OPENAI_API_KEY"
  max_tokens: 4096
  temperature: 0.2

auth:
  enabled: false              # APIèªè¨¼ï¼ˆPOCã§ã¯ç„¡åŠ¹ï¼‰
  api_key_env: "HIVEFORGE_API_KEY"

server:
  host: "0.0.0.0"
  port: 8000

logging:
  level: "INFO"
  events_max_file_size_mb: 100
```

### 9.2 ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|--------|------|------------|
| `HIVEFORGE_VAULT_PATH` | Vaultãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ | `./Vault` |
| `OPENAI_API_KEY` | OpenAI APIã‚­ãƒ¼ | - |
| `HIVEFORGE_API_KEY` | HiveForge APIèªè¨¼ã‚­ãƒ¼ | - |

---

## 10. ä»Šå¾Œã®æ‹¡å¼µ

### 10.1 Phase 1ï¼ˆè¨ˆç”»ä¸­ï¼‰

- [ ] LLM Orchestrator: è‡ªå¾‹çš„ãªã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»å®Ÿè¡Œ
- [ ] Artifactç®¡ç†: æˆæœç‰©ã®ä¿å­˜ã¨å‚ç…§
- [ ] ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ: æŠ•å½±ã®æ°¸ç¶šåŒ–
- [ ] å­å­«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: lineage APIã®é«˜é€ŸåŒ–
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆç½²å: æ”¹ã–ã‚“è€…ã®ç‰¹å®š

### 10.2 VS Codeæ‹¡å¼µã®æ‹¡å……

- [ ] å› æœã‚°ãƒ©ãƒ•å¯è¦–åŒ–ï¼ˆWebviewï¼‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ 
- [ ] ç·Šæ€¥åœæ­¢ãƒœã‚¿ãƒ³
- [ ] æ‰¿èªãƒ€ã‚¤ã‚¢ãƒ­ã‚°

### 10.3 ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

- [ ] ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åˆ¥ãƒã‚§ãƒ¼ãƒ³ï¼ˆä¸¦åˆ—æ›¸ãè¾¼ã¿å¯¾å¿œï¼‰
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- [ ] åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å¯¾å¿œ

---

## å‚ç…§

- [QUICKSTART.md](QUICKSTART.md) - å‹•ä½œç¢ºèªæ‰‹é †
- [AGENTS.md](../AGENTS.md) - AIé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [ã‚³ãƒ³ã‚»ãƒ—ãƒˆ_v3.md](../ã‚³ãƒ³ã‚»ãƒ—ãƒˆ_v3.md) - å®Œå…¨ãªè¨­è¨ˆä»•æ§˜
